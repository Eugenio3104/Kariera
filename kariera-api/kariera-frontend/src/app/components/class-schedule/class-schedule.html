<div class="calendar-wrapper">
  <!-- titolo e descrizione sezione -->
  <div class="calendar-header-main">
    <div class="header-text">
      <h1>Class Schedule</h1>
      <p>Manage your weekly class schedule and activities.</p>
    </div>
    <div class="header-controls">
      <button class="nav-button" (click)="changeWeek(-1)">← Previous Week</button>
      <button class="today-button-gray" (click)="goToCurrentWeek()">Today</button>
      <button class="add-button-gray" (click)="openCreateModal(currentWeek[0], '08:00')">Add Activity</button>
      <button class="nav-button" (click)="changeWeek(1)">Next Week →</button>
    </div>
  </div>

  <!-- calendario -->
  <div class="calendar-grid">
    <!-- riga con time e nomi giorni -->
    <div class="time-column header">Time</div>
    <div class="day-header" *ngFor="let day of days; let i = index">
      {{ day }} <br>
      <small>{{ currentWeek[i] | date:'dd/MM' }}</small>
    </div>

    <!-- righe con slot orari-->
    <ng-container *ngFor="let timeSlot of timeSlots">
      <!-- colonna orario -->
      <div class="time-column">{{ timeSlot }}</div>

      <!-- celle -->
      <div class="day-cell"
           *ngFor="let day of currentWeek.slice(0, 5)"
           (click)="openCreateModal(day, timeSlot)">

        <!-- card per attivita programmatea -->
        <div class="activity-card"
             *ngFor="let activity of getActivitiesForSlot(day, timeSlot)"
             [style.height.px]="calculateActivityHeight(activity)"
             (click)="$event.stopPropagation(); openEditModal(activity)">
          <div class="activity-title">{{ activity.courseName }}</div>
          <div class="activity-details">
            {{ activity.startTime.substring(0,5) }} - {{ activity.endTime.substring(0,5) }}
          </div>
          <div class="activity-details">
            {{ activity.room }} | {{ activity.professor }}
          </div>
          <button class="delete-btn" (click)="$event.stopPropagation(); deleteActivity(activity)">
            ❌
          </button>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- pop up per la creazione e modifica di un'attivita -->
  <div class="popup-background" *ngIf="showModal" (click)="closeModal()">
    <div class="popup-container" (click)="$event.stopPropagation()">

      <!-- header -->
      <div class="popup-header">
        <h2>{{ isEditMode ? 'Edit Activity' : 'New Activity' }}</h2>
      </div>

      <!-- errore -->
      <div class="error-message" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <!-- form da compilare -->
      <div class="popup-body">
        <!-- ✅ CAMPO HIDDEN PER ID -->
        <input type="hidden" [(ngModel)]="activityForm.id" name="id">

        <div class="input">
          <label>Course Name</label>
          <input type="text" [(ngModel)]="activityForm.courseName" name="courseName"
                 class="text-input" placeholder="Enter course name">
        </div>

        <div class="input">
          <label>Room</label>
          <input type="text" [(ngModel)]="activityForm.room" name="room"
                 class="text-input" placeholder="Enter room number">
        </div>

        <div class="input">
          <label>Professor</label>
          <input type="text" [(ngModel)]="activityForm.professor" name="professor"
                 class="text-input" placeholder="Enter professor name">
        </div>

        <div class="input">
          <label>Date</label>
          <input type="date" [(ngModel)]="activityForm.date" name="date"
                 class="text-input">
        </div>

        <div class="input">
          <label>Start Time</label>
          <input type="time" [(ngModel)]="activityForm.startTime" name="startTime"
                 min="08:00" max="18:00" step="3600" class="text-input">
        </div>

        <div class="input">
          <label>End Time</label>
          <input type="time" [(ngModel)]="activityForm.endTime" name="endTime"
                 min="08:00" max="18:00" step="3600" class="text-input">
        </div>
      </div>

      <!-- bottoni cancel e salva -->
      <div class="button">
        <button class="cancel" (click)="closeModal()">Cancel</button>
        <button class="save" (click)="saveActivity()">Save</button>
      </div>

    </div>
  </div>
</div>
